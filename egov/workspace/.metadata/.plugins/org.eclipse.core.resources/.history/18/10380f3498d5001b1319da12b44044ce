<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="kr.happyjob.study.dashboard.dao.DashboardDao">
	
	<select id="cntEngineer" resultType="int">
		/*kr.happyjob.study.system.dao.DashboardDao.cntEngineer*/
		SELECT COUNT(loginID)
		FROM 	tb_userinfo
		WHERE	user_type = 'B'
	</select>	
	
	<select id="cntCompany" resultType="int">
		/*kr.happyjob.study.system.dao.DashboardDao.cntCompany*/
		SELECT COUNT(loginID)
		FROM 	tb_userinfo
		WHERE	user_type = 'C'
	</select>	
	
	<select id="cntProject" resultType="int">
		/*kr.happyjob.study.system.dao.DashboardDao.cntProject*/
		SELECT COUNT(pro_no)
		FROM 	tb_prolist
		<!-- WHERE	reg_date <![CDATA[<=]]> STR_TO_DATE(#{to_date}, '%Y-%m-%d')  --> 
	</select>	
	



	<select id="listlec" resultType="kr.happyjob.study.dashboard.model.LectureModel">
		/*kr.happyjob.study.system.dao.DashboardDao.listlec*/
		   select lc.lec_no
			      ,lc.teach_no
			      ,ui.name
			      ,lc.lec_name
			      ,lc.room_no
			      ,rm.room_name
			      ,DATE_FORMAT(lc.lec_start, '%Y-%m-%d') as lec_start
			      ,DATE_FORMAT(lc.lec_end, '%Y-%m-%d') as lec_end
			      ,lc.lec_cnt
			      ,ll.cnt as std_cnt
			 from tb_lec lc
			       inner join tb_userinfo ui on ui.teach_no = lc.teach_no and ui.user_type = 'T'
			       inner join tb_room rm on rm.room_no = lc.room_no
			       left outer join (
			                             select lec_no
			                                    , count(*) as cnt
			                              from tb_class
			                          ) ll on ll.lec_no = lc.lec_no
			order by lc.lec_start desc
		    LIMIT #{pageIndex}, #{pageSize}
	</select>	
	
	<select id="listleccnt" resultType="int">
		/*kr.happyjob.study.system.dao.DashboardDao.listleccnt*/
		   select count(*)
		    from tb_lec lc
			       inner join tb_userinfo ui on ui.teach_no = lc.teach_no and ui.user_type = 'T'
			       inner join tb_room rm on rm.room_no = lc.room_no
	</select>	
	






	
	
	
	<!-- 
	<select id="cntApplicant" resultType="int">
		/*kr.happyjob.study.system.dao.DashboardDao.cntApplicant*/
		SELECT COUNT(p.loginID)
		FROM 	tb_prolist p, tb_consupport cs
		WHERE	reg_date <![CDATA[<=]]> STR_TO_DATE(#{reg_date}, '%Y-%m-%d') 
	</select>
	 -->
	 
</mapper>