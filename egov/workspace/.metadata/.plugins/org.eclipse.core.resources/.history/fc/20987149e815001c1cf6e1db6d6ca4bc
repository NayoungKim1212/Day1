<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions"%>
<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<title>Job Korea</title>

<jsp:include page="/WEB-INF/view/common/common_include.jsp"></jsp:include>

<!-- D3 -->
<style>
//
click-able rows
	.clickable-rows {tbody tr td { cursor:pointer;
	
}

.el-table__expanded-cell {
	cursor: default;
}
}
</style>
<script type="text/javascript">
        var pageSizeinf  = 3;
        var pageBlockSizeinquiry  = 10;

        var detaileditvue;
        var noticeareavar;
        var noticeeditvue;
        var searchAccvue;
        var acclistvue;
        
		/* onload 이벤트  */
		$(document).ready(function() {
			
			init();
			
			//  selectComCombo(comtype, combo_name, type, searchkey,selvalue)	
			//  comtype    dept : 부서       acc  : 회계계정 중분류   cli : 거래처    pro : 제품(전채)
			//  combo_name   select id
			//  type    sel : 선택   all : 전체
			//  searchkey    comtype이 회계계정 중분류인 경우  회계 계정 대분류 코드
			
			$("#accall").change( function() {			
				selectComCombo("acc", "accdall", "all", $("#accall").val(),"");  
			});
			comcombo("ACCcd", "accall", "all", "");   // Group Code, Combo Name, Option("all" : 전체     "sel" : 선택 , Select Value )  
			selectComCombo("cli", "cilall", "all", "","");  
			selectComCombo("pro", "proall", "all", "","");  
			selectComCombo("dept", "deptall", "all", "","");  
			
			// productCombo(comtype, combo_name, type, code, selvalue)
			// comtype     l : 대분류    m : 중분류    p : 제품정보   
			//  combo_name   select id
			//  type    sel : 선택   all : 전체
			//  code   대분류 인경우 ""    중분류인경우 대분류 코드      제품정보인경우 중분류 코드 
			
			$("#prolall").change( function() {			
				productCombo("m", "promall", "all", $("#prolall").val(),""); 
				
				$('#prodall').children('option').remove();
			});
		
			$("#promall").change( function() {			
				productCombo("p", "prodall", "all", $("#promall").val(),""); 
			});			
			
			productCombo("l","prolall","all","","");
			
			
			
			
			// 공지사항 조회
			fListInf();
			
			// 계정 조회
			fListacc();
			
			//간이차트 조회
			//goChart();
			
			// 버튼 이벤트 등록
			fRegisterButtonClickEvent();
		});
		
		
		function asas() {
			//alert(detaileditvue.dtl_grp_cod);
			//detaileditvue.use_check = "N";
			//alert(detaileditvue.use_check);
			fListInf();
		}


		

		
	function init() {
		
		detaileditvue = new Vue({
			  el: '#samplearea',
			  data: {
			    dtl_grp_cod:"",
			    dtl_grp_cod_nm:"",
			    dtl_cod:"",
			    dtl_cod_nm:"",
			    dtl_cod_eplti:"",
			    dtl_use_poa:"",
			    use_check:"Y"
			  }
			});	  	
		
		
		noticeareavar = new Vue({
			  el: '#divNoticeList',
			  components: {
				                   'bootstrap-table': BootstrapTable
				                },
			  data: {
				  listitem:[]
			  }, 
			  methods:{					
				  detailview:function(no){
					  alert(no);
					  fNoticeModal(no);  
				  }
			  }  
			  
			});		
		
		noticeeditvue = new Vue({
			  el: '#notice',
			  data: {
						  loginId:"",
						  noticeTitle:"",
						  noticeContent:"",
						  loginIdread:"",
						  noticeTitleread:"",
						  noticeContentread:""
			  }
			});	
		
		acclistvue = new Vue({
			  el: '#listacc',
			  components: {
				                   'bootstrap-table': BootstrapTable
				                },
			  data: {
				  acclistitem:[]
			  }, 
			  methods:{					
				  detailview:function(no){
					  alert(no);
					  // fNoticeModal(no);  
				  }
			  }  
			  
			});		
		
	 	
		
		
		
		
	}	
		
	

		
		
		/** 버튼 이벤트 등록 */
		function fRegisterButtonClickEvent() {
			$('a[name=btnInfo]').click(function(e) {
				e.preventDefault();

				var btnId = $(this).attr('id');
				switch (btnId) {
					case 'btnCloseGrpCod' :
					case 'btnCloseDtlCod' :
					gfCloseModal();
					break;
			}
		});
	}
				  
				
		/** 공지사항 조회 */
		function fListInf(currentPage) {
			
			currentPage = currentPage || 1;
			
			console.log("currentPage : " + currentPage);
							    
			var param = {
						currentPage : currentPage
					,	pageSize : pageSizeinf
					,   title        : detaileditvue.dtl_grp_cod
			}
			
			var resultCallback = function(data) {
				fListInfResult(data, currentPage);
			};
			
			//Ajax실행 방식
			//callAjax("Url",type,return,async or sync방식,넘겨준거,값,Callback함수 이름)
			//html로 받을거라 text
			callAjax("/inf/listinfvue.do", "post", "json", true, param, resultCallback);
		}
		
		
		/** 공지사항 조회 콜백 함수 */
		function fListInfResult(data, currentPage) {
					//alert(data);
			//console.log(data);		
			noticeareavar.listitem = data.notice;
			
			console.log("noticeareavar.listitem : " + noticeareavar.listitem.length);		
			
			
			
			// 총 개수 추출
			var totalCntlistInf = data.noticeCnt;
			var list = $("#selectedInfNo").val();
			// 페이지 네비게이션 생성
			var paginationHtml = getPaginationHtml(currentPage, totalCntlistInf, pageSizeinf, pageBlockSizeinquiry, 'fListInf',[list]);
			console.log("paginationHtml : " + paginationHtml);
		
			$("#listInfPagination").empty().append( paginationHtml );
		 
		}
		
		 /*공지사항 상세 조회*/
		 function fNoticeModal(noticeNo) {
		
			 var param = {noticeNo : noticeNo};
			 var resultCallback2 = function(data){
				 fdetailResult(data);
			 };
			 
			 callAjax("/system/detailNotice.do", "post", "json", true, param, resultCallback2);
		 }
		
		 /*  공지사항 상세 조회 -> 콜백함수   */
		 function fdetailResult(data){

			 if(data.resultMsg == "SUCCESS"){
				 //모달 띄우기 
				 gfModalPop("#notice");
				 
				// 모달에 정보 넣기 
				frealPopModal(data.result);
			 
			 }else{
				 alert(data.resultMsg);
			 }
		 }
		
		 /* 팝업 _ 초기화 페이지(신규) 혹은 내용뿌리기  */
		 function frealPopModal(object){
			 
			 
			 noticeeditvue.loginId = object.loginId;
			 noticeeditvue.noticeTitle = object.noticeTitle;
			 noticeeditvue.noticeContent = object.noticeContent;
			 
			 noticeeditvue.loginIdread = "readonly";
			 noticeeditvue.noticeTitleread = "readonly";
			 noticeeditvue.noticeContentread = "readonly";
			 
			 /* 			 
			 $("#loginId").val(object.loginId);
			 $("#loginId").attr("readonly", true); // 작성자 수정불가 
			 
			 $("#write_date").val(object.noticeRegdate);
			 $("#write_date").attr("readonly", true); // 처음 작성된 날짜 수정불가 
			  
			 $("#noticeTitle").val(object.noticeTitle);
			 $("#noticeTitle").attr("readonly", true);

			 $("#noticeContent").val(object.noticeContent);
			 $("#noticeContent").attr("readonly", true);
			 */
			 $("#noticeNo").val(object.noticeNo); // 중요한 num 값도 숨겨서 받아온다. 
			 
		 }

		/** 계정 조회 */
		function fListacc(currentPage) {
			
			currentPage = currentPage || 1;
			
			console.log("currentPage : " + currentPage);
							    
			var param = {
						currentPage : currentPage
					,	pageSize : pageSizeinf
			}
			
			var resultCallback = function(data) {
				fListaccResult(data, currentPage);
			};
			
			//Ajax실행 방식
			//callAjax("Url",type,return,async or sync방식,넘겨준거,값,Callback함수 이름)
			//html로 받을거라 text
			callAjax("/inf/dhacclist.do", "post", "json", true, param, resultCallback);
		}
		
		
		/** 계정 조회 콜백 함수 */
		function fListaccResult(data, currentPage) {
					//alert(data);
			console.log("fListaccResult : " + JSON.stringify(data.accList));		
			acclistvue.acclistitem = data.accList;
			
			console.log("acclistvue.acclistitem : " + acclistvue.acclistitem.length);		
			
			// 총 개수 추출
			var totalCntlistInf = data.accCnt;
			
			// 페이지 네비게이션 생성
			var paginationHtml = getPaginationHtml(currentPage, totalCntlistInf, pageSizeinf, pageBlockSizeinquiry, 'fListacc');
			console.log("paginationHtml : " + paginationHtml);
		
			$("#listaccPagination").empty().append( paginationHtml );
		 
		}		 
		 
		 
		 
		 
		 
			//차트 뿌리러 감
			function goChart(loginID) {
				//alert("1");
				//alert(JSON.stringify(data));
				var param= {
						loginID : loginID
				
				}
			
				var resultCallback1 = function(data) {
			//	 alert("3");
			//	alert(JSON.stringify(data.lec_Name_List));
			//	alert(JSON.stringify(data.lec_Name_List)) 
				
				fChart (data);
			};		 
		 
			// bar형 chart
			function fChart(data){
			
				//일단 간단한 값만
				var cntEngineer = data.cntEngineer;
				var cntCompany = data.cntCompany;
				var cntProject = data.cntProject;
				//var cntApplicant = ${cntApplicant};
				
				var minChart = new Chart($("#minChart"),{
					
					type : 'bar' ,
					data : {
						labels : ['가입된 엔지니어 수', '가입된 기업 수', '등록된 프로젝트 수', '일별 지원자 수'] ,
							datasets : [{
									label : '간이 통계' ,
									data : [cntEngineer, cntCompany, cntProject] ,
									borderColor: [
													'rgba(255, 99, 132, 1)' ,
													'rgba(255, 206, 86, 0.2)',
													'rgba(54, 162, 235, 0.2)'
												] ,
									borderWidth : 1
							}]
					}
				});
			}
			alert("2");
			callAjax("/dashboard/goChart.do", "post", "json", true, param, resultCallback1);
		}

</script>

</head>
<body>
<form id="myForm" action=""  method="">

<input type="hidden" id="currentPage" value="1">
<input type="hidden" id="selectedInfNo" value="">
	<!-- 모달 배경 -->
	<div id="mask"></div>

	<div id="wrap_area">

		<h2 class="hidden">컨텐츠 영역</h2>
		<div id="container">
			<ul>
				<li class="lnb">
					<!-- lnb 영역 --> <jsp:include
						page="/WEB-INF/view/common/lnbMenu.jsp"></jsp:include> <!--// lnb 영역 -->
				</li>
				<li class="contents">
					<!-- contents -->
					<h3 class="hidden">contents 영역</h3> <!-- content -->
	               
					<div class="content" style="margin-bottom:20px;">
                       
						<p class="Location">
							<a href="../dashboard/dashboard.do" class="btn_set home">메인으로</a> <span
								class="btn_nav bold">메인</span> <a href="../dashboard/dashboard.do"
								class="btn_set refresh">새로고침</a>
						</p>

						<p class="conTitle" style="margin-bottom: 1%;">
							<span>공지 사항</span> <span class="fr"> 
								<span>로그인</span>
								<span>회원가입</span>
								<span>마이페이지</span>
								
							</span>
						</p>

						<div id="samplearea">
						      <input type=text" v-model="dtl_grp_cod" />
						      {{ dtl_grp_cod }} 
						      
						      <select v-model="use_check">
						             <option value="">전체</option>
						             <option value="Y">Y</option>
						             <option value="N">N</option>
						      </select>
						      
						      
						      <a href="javascript:asas();"	 class="btnType gray"  id="btnClose2222" name="btn"><span>확인</span></a>
						      
						</div>
						
				        <div id="divNoticeList">
							<div class="bootstrap-table">
								<div class="fixed-table-toolbar">
									<div class="bs-bars pull-left"></div>
									<div class="columns columns-right btn-group pull-right">	</div>
								</div>
								<div class="fixed-table-container" style="padding-bottom: 0px;">
									<div class="fixed-table-body">		
											<table class="col">
												<caption>caption</caption>
												<colgroup>
												   <col width="5%">
													<col width="70%">
													<col width="10%">
													<col width="5%">
												</colgroup>
							
												<thead>
													<tr>
													    <th scope="col">번호</th>
														<th scope="col">제목</th>
														<th scope="col">작성일</th>
														<th scope="col">작성자</th>
													</tr>
												</thead>
												<tbody id="listInf" v-for="(item,index) in listitem" v-if="listitem.length">
												      <tr @click="detailview(item.noticeNo)">
													    <td>{{ item.noticeNo }}</td>
														<td>{{ item.noticeTitle }}</td>
														<td>{{ item.noticeRegdate }}</td>
														<td>{{ item.loginId }}</td>									
												      </tr>
												</tbody>
											</table>
									</div>
                                    <div>
											<div>
												<div class="clearfix" />
											</div>
									</div>
								</div>			             
				             
				             
								
							</div>
						</div>				   
					   <div class="paging_area"  id="listInfPagination"> </div>
					   
				

						   <table width="100%" cellpadding="5" cellspacing="0" border="1"
			                        align="left" 
			                        style="border-collapse: collapse; border: 10px #50bcdf; ">
									<caption>caption</caption>
										<colgroup>
										   <col width="13%">
											<col width="13%">
											<col width="13%">
											<col width="13%">
											<col width="13%">
											<col width="13%">
											<col width="13%">
											<col width="13%">
										</colgroup>
										<tbody>
						                        <tr style="border: 10px; border-color: blue">
						                           <td width="40" height="25" style="font-size: 100%">계정대분류</td><td><select id="accall" name="accall"  >	</select></td>
						                           <td width="40" height="25" style="font-size: 100%">계정중분류</td><td><select id="accdall" name="accdall" >	</select></td>   
						                           <td width="40" height="25" style="font-size: 100%">거래처</td><td><select id="cilall" name="cilall" >	</select></td>          
						                           <td width="40" height="25" style="font-size: 100%">제품</td><td><select id="proall" name="proall" >	</select></td>        
						                        </tr>
						                        
						                        <tr style="border: 10px; border-color: blue">
						                           <td width="40" height="25" style="font-size: 100%">제품대분류</td><td><select id="prolall" name="prolall"  >	</select></td>
						                           <td width="40" height="25" style="font-size: 100%">제품중분류</td><td><select id="promall" name="promall" >	</select></td>   
						                           <td width="40" height="25" style="font-size: 100%">제품</td><td><select id="prodall" name="prodall" >	</select></td>          
						                           <td width="40" height="25" style="font-size: 100%">부서</td><td><select id="deptall" name="deptall" >	</select></td>        
						                        </tr>
										</tbody>
			                 </table>    

					 
					   <!-- 계정 조회 -->
						<table width="100%" cellpadding="5" cellspacing="0" border="1"
	                        align="left" 
	                        style="border-collapse: collapse; border: 10px #50bcdf; ">
	                        <tbody>
		                        <tr style="border: 10px; border-color: blue">
		                           <td width="20" height="25" style="font-size: 120%">&nbsp;&nbsp;</td>
		
		                           <td width="220" height="25" style="font-size: 150%; font-weight: bold;">전표 조회</td>
		                           <td width="180" height="25" style="font-size: 120%">&nbsp;&nbsp;</td>        
		                           <td width="100" height="60" style="font-size: 120%">
		                           <a href="" class="btnType blue" id="searchBtn" name="btn"><span>검  색</span></a></td> 
		                           <td width="20" height="25" style="font-size: 120%">&nbsp;&nbsp;</td>        
		                        </tr>
	                        </tbody>
	                     </table>


				        <div id="listacc">
							<div class="bootstrap-table">
								<div class="fixed-table-toolbar">
									<div class="bs-bars pull-left"></div>
									<div class="columns columns-right btn-group pull-right">	</div>
								</div>
								<div class="fixed-table-container" style="padding-bottom: 0px;">
									<div class="fixed-table-body">		
											<table class="col">
												<caption>caption</caption>
												<colgroup>
													<col width="13%">
													<col width="9%">
													<col width="13%">
													<col width="13%">
													<col width="13%">
													<col width="13%">
													<col width="13%">
													<col width="13%">
												</colgroup>
												<thead>
													<tr>
														<th scope="col">전표번호</th>
														<th scope="col">계정대분류명</th>
														<th scope="col">계정상세명</th>
														<th scope="col">거래처명</th>
														<th scope="col">담당부서</th>
														<th scope="col">제품명</th>
														<th scope="col">발생일자</th>
														<th scope="col">금액</th>
													</tr>
												</thead>
												<tbody id="listacc" v-for="item in acclistitem" v-if="acclistitem.length">
												      <tr @click="detailview(item.slipNo)">
													       <td>{{ item.slipNo }}</td>
												           <td>{{ item.accountNm }}</td>
												           <td>{{ item.detailAccountNm }}</td>
												           <td>{{ item.clientNm }}</td>
												           <td>{{ item.deptName }}</td>
												           <td>{{ item.prodNm }}</td>
												           <td>{{ item.occurDate }}</td>
												           <td>{{ item.amt }}</td>								
												      </tr>
												</tbody>
											</table>
									</div>
                                    <div>
											<div>
												<div class="clearfix" />
											</div>
									</div>
								</div>	
							</div>
						</div>  
						<div class="paging_area"  id="listaccPagination"> </div>
					</li>
			</ul>
	</div>
		
	<!-- 모달팝업 -->
	<div id="notice" class="layerPop layerType2" style="width: 600px;">
		<input type="hidden" id="noticeNo" name="noticeNo" value="${noticeNo}"> <!-- 수정시 필요한 num 값을 넘김  -->
		
		<dl>
			<dt>
				<strong>공지사항</strong>
			</dt>
			<dd class="content">
				<!-- s : 여기에 내용입력 -->
				<table class="row">
					<caption>caption</caption>

					<tbody>
						<tr>
							<th scope="row">작성자 <span class="font_red">*</span></th>
							<td><input type="text" class="inputTxt p100" name="loginId" id="loginId" v-model="loginId" v-bind:readonly="loginIdread" /></td>
							<!-- <th scope="row">작성일<span class="font_red">*</span></th>
							<td><input type="text" class="inputTxt p100" name="write_date" id="write_date" /></td> -->
						</tr>
						<tr>
							<th scope="row">제목 <span class="font_red">*</span></th>
							<td colspan="3">
							        <input type="text" class="inputTxt p100"	name="noticeTitle" id="noticeTitle" v-model="noticeTitle" v-bind:readonly="noticeTitleread" />
							 </td>
						</tr>
						<tr>
							<th scope="row">내용</th>
							<td colspan="3">
								<textarea class="inputTxt p100" name="noticeContent" id="noticeContent" v-model="noticeContent" v-bind:readonly="noticeContentread">
								</textarea>
							</td>
						</tr>
						
					</tbody>
				</table>

				<!-- e : 여기에 내용입력 -->

				<div class="btn_areaC mt30">
					<a href=""	class="btnType gray"  id="btnClose" name="btn"><span>닫기</span></a>
				</div>
			</dd>

		</dl>
	</div>
  
</form>
</body>
</html>